/**
 * tracking.js - Augmented Reality JavaScript Framework.
 * @author Eduardo Lundgren <edu@rdo.io>
 * @version v0.0.1
 * @link http://trackingjs.com
 * @license BSD
 */
!function(r){r.tracking=r.tracking||{},tracking.forEach=function(r,t,a){var n;if(Array.isArray(r))r.forEach(function(){t.apply(a,arguments)});else for(n in r)r.hasOwnProperty(n)&&t.call(a,r[n],n,r);return r},tracking.inherits=function(r,t){function a(){}a.prototype=t.prototype,r.superClass_=t.prototype,r.prototype=new a,r.prototype.constructor=r,r.base=function(r,a){var n=Array.prototype.slice.call(arguments,2);return t.prototype[a].apply(r,n)}},tracking.isNode=function(r){return r.nodeType||this.isWindow(r)},tracking.isWindow=function(r){return!!(r&&r.alert&&r.document)},tracking.merge=function(r,t){for(var a in t)r[a]=t[a];return r},tracking.one=function(r,t){return this.isNode(r)?r:(t||document).querySelector(r)},tracking.track=function(r,t,a){if(r=tracking.one(r),!r)throw new Error("Element not found, try a different element or selector.");if(!t)throw new Error("Tracker not specified, try `tracking.track(element, new FaceTracker())`.");switch(r.nodeName.toLowerCase()){case"canvas":return this.trackCanvas_(r,t,a);case"img":return this.trackImg_(r,t,a);case"video":return this.trackVideo_(r,t,a);default:throw new Error("Element not supported, try in a canvas, img, or video.")}},tracking.trackCanvas_=function(r,t){var a=r.width,n=r.height,o=r.getContext("2d"),e=o.getImageData(0,0,a,n);t.track(e.data,a,n)},tracking.trackImg_=function(r,t){var a=r.width,n=r.height,o=document.createElement("canvas");o.width=a,o.height=n,tracking.Canvas.loadImage(o,r.src,0,0,a,n,function(){tracking.trackCanvas_(o,t)})},tracking.trackVideo_=function(t,a){var n=document.createElement("canvas"),o=n.getContext("2d"),e=t.offsetWidth,i=t.offsetHeight;n.width=e,n.height=i,r.requestAnimationFrame(function(){t.readyState===t.HAVE_ENOUGH_DATA&&(o.drawImage(t,0,0,e,i),tracking.trackCanvas_(n,a)),tracking.trackVideo_(t,a)})},r.self.Int8Array||(r.self.Int8Array=Array),r.self.Uint8Array||(r.self.Uint8Array=Array),r.self.Uint8ClampedArray||(r.self.Uint8ClampedArray=Array),r.self.Uint16Array||(r.self.Uint16Array=Array),r.self.Int32Array||(r.self.Int32Array=Array),r.self.Uint32Array||(r.self.Uint32Array=Array),r.self.Float32Array||(r.self.Float32Array=Array),r.self.Float64Array||(r.self.Float64Array=Array),r.URL||(r.URL=r.URL||r.webkitURL||r.msURL||r.oURL)}(window),function(){tracking.Brief={},tracking.Brief.N=128,tracking.Brief.getDescriptors=function(){},tracking.Brief.match=function(){}}(),function(){tracking.Canvas={},tracking.Canvas.loadImage=function(r,t,a,n,o,e,i){var c=this,s=new window.Image;s.onload=function(){var t=r.getContext("2d");t.drawImage(s,a,n,o,e),i&&i.call(c),s=null},s.src=t}}(),function(){tracking.ePnP={},tracking.ePnP.estimatePose=function(r,t){var a=[],n=[];r=new tracking.Matrix({matrix:r});for(var o=0;4>o;++o){var e=t.pop();n.push(e.frameKeypoint),a.push(e.templateKeypoint)}for(var i=this.createHomogeneousSystem(r,a,n,t),c=this.oneDimesionalKernel(i.transpose().multiply(i),a),s=c._matrix.data,u=0;4>u;u++){var g=new tracking.Matrix({matrix:[s[3*u],s[3*u+1],s[3*u+2]]});console.log("projected:\n",r.multiply(g).toString())}},tracking.ePnP.findNullEigenVectors=function(r){for(var t,a=numeric.svd(r.data),n=a.U,o=[],e=0;e<n[0].length;e++){t=[];for(var i=0;i<n.length;i++)t.push(n[i][e]);o.push(new tracking.Vector(t))}return o},tracking.ePnP.oneDimesionalKernel=function(r,t){for(var a=tracking.ePnP.findNullEigenVectors(r),n=0,o=0,e=8;12>e;e++){var i=a[e],c=i._matrix.data,s=new tracking.Vector([[c[0]],[c[1]],[c[2]]]),u=new tracking.Vector([[c[3]],[c[4]],[c[5]]]),g=new tracking.Vector([[c[6]],[c[7]],[c[8]]]),k=new tracking.Vector([[c[9]],[c[10]],[c[11]]]),f=[s,u,g,k];n=0,o=0;for(var l=0;4>l;l++)for(var p=0;4>p;p++)n+=tracking.Vector.subtract(f[l],f[p]).norm()*tracking.Vector.subtract(t[l],t[p]).norm(),o+=tracking.Vector.subtract(f[l],f[p]).squaredNorm();console.log("eigenVectors["+e+"]:\n",a[e].multiply(n/o).toString())}return a[10].multiply(n/o)},tracking.ePnP.findBarycentricCoordenates=function(r,t){for(var a,n=new tracking.Matrix({rows:3,cols:3}),o=n.data,e=[t[0]._matrix.data,t[1]._matrix.data,t[2]._matrix.data,t[3]._matrix.data],i=0;3>i;i++)for(var c=0;3>c;c++)o[c][i]=e[i][c][0]-e[3][c][0];return n=n.invert3by3(),a=n.multiply(tracking.Vector.subtract(r,t[3])._matrix).data,[a[0][0],a[1][0],a[2][0],1-a[0][0]-a[1][0]-a[2][0]]},tracking.ePnP.createHomogeneousSystem=function(r,t,a,n){for(var o,e,i,c=n.length,s=r.data[0][0],u=r.data[1][1],g=r.data[0][2],k=r.data[1][2],f=new tracking.Matrix({rows:2*c,cols:12}),l=f.data,p=0;p<n.length;p++){o=this.findBarycentricCoordenates(n[p].templateKeypoint,t),e=g-n[p].frameKeypoint._matrix.data[0],i=k-n[p].frameKeypoint._matrix.data[1];for(var y=0;4>y;y++)l[2*p][3*y]=o[y]*s,l[2*p][3*y+1]=0,l[2*p][3*y+2]=o[y]*e,l[2*p+1][3*y]=0,l[2*p+1][3*y+1]=o[y]*u,l[2*p+1][3*y+2]=o[y]*i}return f}}(),function(){tracking.Fast={},tracking.Fast.isCorner=function(){}}(),function(){tracking.Math={},tracking.Math.distance=function(r,t,a,n){var o=a-r,e=n-t;return Math.sqrt(o*o+e*e)},tracking.Math.hammingDistance=function(r,t){var a,n,o=0;for(a=0,n=r.length;n>a;a++)o+=this.hammingWeight(r[a]^t[a]);return o},tracking.Math.hammingWeight=function(r){return r-=r>>1&1431655765,r=(858993459&r)+(r>>2&858993459),16843009*(r+(r>>4)&252645135)>>24}}(),function(){tracking.Matrix=function(r){var t=this,a=r.matrix,n=r.rows,o=r.cols;if(a)n=a.length,o=a[0].length;else{a=new Array(n);for(var e=0;n>e;e++)a[e]=new Array(o)}t.data=a,t._rows=n,t._cols=o},tracking.Matrix.forEach=function(r,t,a,n,o){var e,i=o||1,c=0,s=0;for(c=0;a>c;c+=i)for(s=0;t>s;s+=i)e=c*t*4+4*s,n.call(this,r[e],r[e+1],r[e+2],r[e+3],e,c,s)},tracking.Matrix.transform=function(r,t,a,n){return tracking.Matrix.forEach(r,t,a,function(t,a,o,e,i){var c=n.apply(null,arguments);r[i]=c[0],r[i+1]=c[1],r[i+2]=c[2],r[i+3]=c[3]}),r},tracking.Matrix.prototype.invert3by3=function(){var r=this,t=r.data,a=new tracking.Matrix({rows:3,cols:3}),n=a.data,o=r.determinant3by3_();return n[0][0]=(t[1][1]*t[2][2]-t[2][1]*t[1][2])/o,n[1][0]=-(t[1][0]*t[2][2]-t[1][2]*t[2][0])/o,n[2][0]=(t[1][0]*t[2][1]-t[1][1]*t[2][0])/o,n[0][1]=-(t[0][1]*t[2][2]-t[0][2]*t[2][1])/o,n[1][1]=(t[0][0]*t[2][2]-t[0][2]*t[2][0])/o,n[2][1]=-(t[0][0]*t[2][1]-t[0][1]*t[2][0])/o,n[0][2]=(t[0][1]*t[1][2]-t[0][2]*t[1][1])/o,n[1][2]=-(t[0][0]*t[1][2]-t[0][2]*t[1][0])/o,n[2][2]=(t[0][0]*t[1][1]-t[0][1]*t[1][0])/o,a},tracking.Matrix.prototype.determinant3by3_=function(){var r,t=this,a=t.data;return r=a[0][0]*a[1][1]*a[2][2],r+=a[1][0]*a[2][1]*a[0][2],r+=a[2][0]*a[0][1]*a[1][2],r-=a[0][2]*a[1][1]*a[2][0],r-=a[1][2]*a[2][1]*a[0][0],r-=a[2][2]*a[0][1]*a[1][0]},tracking.Matrix.prototype.multiply=function(r){for(var t=this,a=t.data,n=t._rows,o=t._cols,e=r.data,i=r._cols,c=new tracking.Matrix({rows:n,cols:i}),s=c.data,u=n-1;u>=0;u--)for(var g=i-1;g>=0;g--){s[u][g]=0;for(var k=o-1;k>=0;k--)s[u][g]+=a[u][k]*e[k][g]}return c},tracking.Matrix.prototype.subtract=function(r){for(var t=this,a=t.data,n=t._rows,o=t._cols,e=r.data,i=new tracking.Matrix({rows:n,cols:o}),c=i.data,s=n-1;s>=0;s--)for(var u=o-1;u>=0;u--)c[s][u]=a[s][u]-e[s][u];return i},tracking.Matrix.prototype.transpose=function(){for(var r=this,t=r._rows,a=r._cols,n=r.data,o=new tracking.Matrix({rows:a,cols:t}),e=o.data,i=t-1;i>=0;i--)for(var c=a-1;c>=0;c--)e[c][i]=n[i][c];return o},tracking.Matrix.prototype.rowEchelon=function(){for(var r=this,t=r._rows,a=r._cols,n=r.data,o=0;t>o;o++)for(var e=o+1;t>e;e++)for(var i=a-1;i>=0;i--)n[e][i]=n[e][i]-n[o][i]*n[e][o]/n[o][o];return r},tracking.Matrix.prototype.reducedRowEchelon=function(){var r,t,a,n,o,e=this,i=e._rows,c=e._cols,s=0;for(a=0;i>a;a++){if(s>=c)return e;for(n=a;0===e.data[n][s];)if(n++,i===n&&(n=a,s++,c===s))return e;for(r=e.data[n],e.data[n]=e.data[a],e.data[a]=r,t=e.data[a][s],o=0;c>o;o++)e.data[a][o]/=t;for(n=0;i>n;n++)if(n!==a)for(t=e.data[n][s],o=0;c>o;o++)e.data[n][o]-=t*e.data[a][o];s++}return e},tracking.Matrix.prototype.toString=function(){for(var r=this,t=r._rows,a=r._cols,n=r.data,o="",e=0;t>e;e++){o+="[	";for(var i=0;a>i;i++)o+=n[e][i]+"	";o+="]\n"}return o}}(),function(){tracking.Vector=function(r){var t=this,a=r.matrix,n=r.dimension;Array.isArray(r)&&(a=new tracking.Matrix({matrix:[r]}).transpose()),a?n=a._rows:n&&(a=new tracking.Matrix({rows:n,cols:1})),t._matrix=a,t._dimension=n},tracking.Vector.subtract=function(r,t){return new tracking.Vector({matrix:r._matrix.subtract(t._matrix)})},tracking.Vector.prototype.squaredNorm=function(){var r=this._matrix;return r.transpose().multiply(r).data[0][0]},tracking.Vector.prototype.norm=function(){return Math.sqrt(this.squaredNorm())},tracking.Vector.prototype.toString=function(){return this._matrix.toString()},tracking.Vector.prototype.multiply=function(r){for(var t=[],a=this._dimension,n=0;a>n;n++)t.push(this._matrix.data[n][0]*r);return new tracking.Vector(t)}}(),function(){tracking.Tracker=function(){},tracking.Tracker.prototype.type=null,tracking.Tracker.prototype.getType=function(){return this.type},tracking.Tracker.prototype.onFound=function(){},tracking.Tracker.prototype.onNotFound=function(){},tracking.Tracker.prototype.setType=function(r){this.type=r},tracking.Tracker.prototype.track=function(){}}(),function(){tracking.ColorTracker=function(){this.setType("color"),this.setColors(["magenta"])},tracking.inherits(tracking.ColorTracker,tracking.Tracker),tracking.ColorTracker.MIN_PIXELS=30,tracking.ColorTracker.knownColors_={},tracking.ColorTracker.registerColor=function(r,t){tracking.ColorTracker.knownColors_[r]=t},tracking.ColorTracker.getColor=function(r){return tracking.ColorTracker.knownColors_[r]},tracking.ColorTracker.prototype.colors=null,tracking.ColorTracker.prototype.calculateCentralCoordinate_=function(r,t){for(var a=0,n=0,o=-1,e=-1,i=1/0,c=1/0,s=0,u=0;t>u;u+=2){var g=r[u],k=r[u+1];g>-1&&k>-1&&(a+=g,n+=k,s++,i>g&&(i=g),g>o&&(o=g),c>k&&(c=k),k>e&&(e=k))}return 0===s?null:{x:a/s,y:n/s,z:60-(o-i+(e-c))/2}},tracking.ColorTracker.prototype.flagOutliers_=function(r,t){for(var a=0;t>a;a+=2){for(var n=0,o=2;t>o;o+=2)n+=tracking.Math.distance(r[a],r[a+1],r[o],r[o+1]);n/t>=tracking.ColorTracker.MIN_PIXELS&&(r[a]=-1,r[a+1]=-1,t[a]--)}},tracking.ColorTracker.prototype.getColors=function(){return this.colors},tracking.ColorTracker.prototype.setColors=function(r){this.colors=r},tracking.ColorTracker.prototype.track=function(r,t,a){var n,o,e,i=this,c=this.getColors(),s=[],u=[],g=[];for(tracking.Matrix.forEach(r,t,a,function(r,t,a,u,k,f,l){for(e=-1;n=c[++e];)s[e]||(g[e]=0,s[e]=[]),o=tracking.ColorTracker.knownColors_[n],o&&o.call(i,r,t,a,u,k,f,l)&&(g[e]+=2,s[e].push(l,f))}),e=-1;n=c[++e];)if(!(g[e]<tracking.ColorTracker.MIN_PIXELS)){i.flagOutliers_(s[e],g[e]);var k=i.calculateCentralCoordinate_(s[e],g[e]);k&&(k.color=c[e],k.pixels=s[e],u.push(k))}u.length?i.onFound&&i.onFound.call(i,u):i.onNotFound&&i.onNotFound.call(i,u)},tracking.ColorTracker.registerColor("cyan",function(r,t,a){var n=50,o=70,e=r-0,i=t-255,c=a-255;return t-r>=n&&a-r>=o?!0:Math.sqrt(e*e+i*i+c*c)<80}),tracking.ColorTracker.registerColor("magenta",function(r,t,a){var n=50,o=r-255,e=t-0,i=a-255;return r-t>=n&&a-t>=n?!0:Math.sqrt(o*o+e*e+i*i)<140}),tracking.ColorTracker.registerColor("yellow",function(r,t,a){var n=50,o=r-255,e=t-255,i=a-0;return r-t>=n&&a-t>=n?!0:Math.sqrt(o*o+e*e+i*i)<100})}(),function(){tracking.KeypointTracker=function(){this.setType("keypoint")},tracking.inherits(tracking.KeypointTracker,tracking.Tracker),tracking.KeypointTracker.prototype.getCameraIntrisicParameters=function(){var r=this;return r._cameraIntrisicParameters||(r._cameraIntrisicParameters=new tracking.Matrix({matrix:[[2868.4,0,1219.5],[0,2872.1,1591.7],[0,0,1]]})),r._cameraIntrisicParameters},tracking.KeypointTracker.prototype.setCameraIntrisicParameters=function(r){this._cameraIntrisicParameters=Array.isArray(r)?new tracking.Matrix(r):r},tracking.KeypointTracker.prototype._extractKeypoints=function(){},tracking.KeypointTracker.prototype._matchKeypoints=function(){},tracking.KeypointTracker.prototype._estimatePose=function(){},tracking.KeypointTracker.prototype.track=function(){}}();